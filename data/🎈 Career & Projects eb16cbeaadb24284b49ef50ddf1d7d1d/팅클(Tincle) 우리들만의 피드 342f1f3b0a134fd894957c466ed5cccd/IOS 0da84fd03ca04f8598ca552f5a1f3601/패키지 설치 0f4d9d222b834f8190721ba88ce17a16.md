# 패키지 설치

ios/android 빌드 일지

현재 상태 : ios, and 다 빌드 안됨

- 첫 빌드
    
    첫 pod install -repoupdate
    
    오류
    
    ```bash
    The Swift pod `FirebaseCoreInternal` depends upon `GoogleUtilities`, which does not define modules.
    To opt into those targets generating module maps (which is necessary to import them from Swift when building as static libraries), you may set `use_modular_headers!` globally in your Podfile, or specify `:modular_headers => true` for particular dependencies.
    ```
    
    [https://velog.io/@qkr135qkr/firebase를-iOS에-적용하면서-맞닦들인-문제들](https://velog.io/@qkr135qkr/firebase%EB%A5%BC-iOS%EC%97%90-%EC%A0%81%EC%9A%A9%ED%95%98%EB%A9%B4%EC%84%9C-%EB%A7%9E%EB%8B%A6%EB%93%A4%EC%9D%B8-%EB%AC%B8%EC%A0%9C%EB%93%A4)
    
    ![스크린샷 2023-12-28 오후 11.02.35.png](%E1%84%91%E1%85%A2%E1%84%8F%E1%85%B5%E1%84%8C%E1%85%B5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%200f4d9d222b834f8190721ba88ce17a16/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-12-28_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_11.02.35.png)
    
    로 해결 가능
    
    ```bash
    pod 'GoogleUtilities', :modular_headers => true
    ```
    
    ```bash
    target 'tinqle' do
      config = use_native_modules!
      pod 'GoogleUtilities', :modular_headers => true #추가
    ```
    
    → pod 는 되는데 실행이 안됨 ( ios, and ) 모두
    
    ios : firebase/ kakao 등 ios 설정이 빠진듯
    
    and: why? 왜 안되지?
    
    [android 시도]
    
    안드로이드 폴더에서   ./gradlew clean 시도
    
    → 권한이 없음
    
    ```bash
    chmod +x gradlew
    ```
    
    권한 부여 후 재시도
    
    좀 설치 되다가 뻑남
    
    오류 메시지
    
    ```bash
    Configure project :react-native-flipper
    WARNING:Software Components will not be created automatically for Maven publishing from Android Gradle Plugin 8.0. To opt-in to the future behavior, set the Gradle property android.disableAutomaticComponentCreation=true in the `gradle.properties` file or use the new publishing DSL.
    
    > Task :app:processDebugGoogleServices FAILED
    
    Deprecated Gradle features were used in this build, making it incompatible with Gradle 9.0.
    
    You can use '--warning-mode all' to show the individual deprecation warnings and determine if they come from your own scripts or plugins.
    
    See https://docs.gradle.org/8.0.1/userguide/command_line_interface.html#sec:command_line_warnings
    26 actionable tasks: 21 executed, 5 up-to-date
    
    info 💡 Tip: Make sure that you have set up your development environment correctly, by running react-native doctor. To read more about doctor command visit: https://github.com/react-native-community/cli/blob/main/packages/cli-doctor/README.md#doctor 
    
    FAILURE: Build failed with an exception.
    
    * What went wrong:
    Execution failed for task ':app:processDebugGoogleServices'.
    > File google-services.json is missing. The Google Services Plugin cannot function without it. 
       Searched Location: 
      /Users/sjsjmine1/Desktop/Tinqle-frontend/android/app/src/debug/google-services.json
      /Users/sjsjmine1/Desktop/Tinqle-frontend/android/app/src/google-services.json
      /Users/sjsjmine1/Desktop/Tinqle-frontend/android/app/src/Debug/google-services.json
      /Users/sjsjmine1/Desktop/Tinqle-frontend/android/app/google-services.json
    
    * Try:
    > Run with --stacktrace option to get the stack trace.
    > Run with --info or --debug option to get more log output.
    > Run with --scan to get full insights.
    
    * Get more help at https://help.gradle.org
    
    BUILD FAILED in 46s
    error Failed to install the app.
    info Run CLI with --verbose flag for more details.
    ```
    
    gpt
    
    ```bash
    The error indicates that the build process is failing because the google-services.json file is missing. This file is required for integrating Firebase services in your Android app.
    
    Here are the steps to resolve the issue:
    
    Add google-services.json: Make sure you have the google-services.json file for your Firebase project. This file contains configuration details for Firebase services. You can download it from the Firebase Console.
    
    Go to the Firebase Console.
    Select your project.
    In the left sidebar, click on the gear icon and go to Project settings.
    In the Your apps section, click on the Android icon.
    Download the google-services.json file.
    Once you have the file, place it in the android/app directory of your React Native project.
    ```
    
    파이어 베이스 서비스키 가 없다
    
    12/30
    
    서비스키 받음
    
    안드로이드 빌드 시도
    
    안드로이드 빌드 성공 → 파일들 없어서 실패 했던 것
    

# IOS 패키지 설정

문제인 패키지가 어느것인지 확인

yarn remove 로 하나씩 삭제

- firebase 삭제
    
    @react-native-firebase/app
    
    @react-native-firebase/auth
    
    @react-native-firebase/messaging
    
    ![스크린샷 2023-12-30 오후 4.52.58.png](%E1%84%91%E1%85%A2%E1%84%8F%E1%85%B5%E1%84%8C%E1%85%B5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%200f4d9d222b834f8190721ba88ce17a16/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-12-30_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.52.58.png)
    
    ios 실행 불가 오류 로그 간단히 봤을 때는 무슨 문제인지 모르
    
- 카카오 삭제
    
    @react-native-seoul/kakao-login
    
    ![simulator_screenshot_AE4E5742-6F47-455A-A03B-7E8A0F60A0D9.png](%E1%84%91%E1%85%A2%E1%84%8F%E1%85%B5%E1%84%8C%E1%85%B5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%200f4d9d222b834f8190721ba88ce17a16/simulator_screenshot_AE4E5742-6F47-455A-A03B-7E8A0F60A0D9.png)
    
    기존의 오류는 사라짐 but 새로운 오류 발생
    
    빌드는 잘 되고 작동도 잘됨 But 저 오류 발생
    
    오류 관련 링크
    
    [https://stackoverflow.com/questions/61980130/console-error-no-permission-handler-detected-react-native](https://stackoverflow.com/questions/61980130/console-error-no-permission-handler-detected-react-native)
    
    찾아보니 **react-native-permissions 패키지의 설정이 안되어있는 문제**
    
    [https://www.npmjs.com/package/react-native-permissions](https://www.npmjs.com/package/react-native-permissions)
    
    위 공식 문서의 설정을 충실히 수행했다.
    
    Profile
    
    ```bash
    # delete for react-native-permissions 12/30 sj
    # # Resolve react_native_pods.rb with node to allow for hoisting
    # require Pod::Executable.execute_command('node', ['-p',
    #   'require.resolve(
    #     "react-native/scripts/react_native_pods.rb",
    #     {paths: [process.argv[1]]},
    #   )', __dir__]).strip
    
    # add for react-native-permissions 12/30 sj
    def node_require(script)
       # Resolve script with node to allow for hoisting
    require Pod::Executable.execute_command('node', ['-p',
      "require.resolve(
        '#{script}',
        {paths: [process.argv[1]]},
      )", __dir__]).strip
    end
    
    node_require('react-native/scripts/react_native_pods.rb')
    node_require('react-native-permissions/scripts/setup.rb')
    
    platform :ios, min_ios_version_supported
    prepare_react_native_project!
    
    # add for react-native-permissions 12/30 sj
    # ⬇️ uncomment wanted permissions
    setup_permissions([
      # 'AppTrackingTransparency',
      # 'Bluetooth',
      # 'Calendars',
      # 'CalendarsWriteOnly',
      'Camera',
      # 'Contacts',
      # 'FaceID',
      # 'LocationAccuracy',
      # 'LocationAlways',
      # 'LocationWhenInUse',
      # 'MediaLibrary',
      # 'Microphone',
      # 'Motion',
      'Notifications',
      'PhotoLibrary',
      # 'PhotoLibraryAddOnly',
      # 'Reminders',
      # 'Siri',
      # 'SpeechRecognition',
      # 'StoreKit',
    ])
    ```
    
    info.plist
    
    ```bash
    <!-- react-native-permissions -->
    	 <key>NSCameraUsageDescription</key>
      <string>tinqle앱의 카메라 권한을 허용하시겠습니까?</string>
    	<key>NSPhotoLibraryUsageDescription</key>
      <string>사진 사용을 위해 tinqle앱의 갤러리 접근을 허용하시겠습니까?</string>
    ```
    
    에러 해결 완료!
    

## 삭제한 모듈 재설치 시작

## 1. @react-native-seoul/kakao-login

공식 문서  [https://www.npmjs.com/package/@react-native-seoul/kakao-login](https://www.npmjs.com/package/@react-native-seoul/kakao-login)

설치 할 때 참고링크 [https://velog.io/@psb7391/RN-React-Native-카카오-로그인](https://velog.io/@psb7391/RN-React-Native-%EC%B9%B4%EC%B9%B4%EC%98%A4-%EB%A1%9C%EA%B7%B8%EC%9D%B8)

info.plist

```bash
<!-- kaako login -->
	<key>CFBundleURLTypes</key>
	 <array>
		<dict>
	  <key>CFBundleTypeRole</key>
  	<string>Editor</string>
		<key>CFBundleURLSchemes</key>
		<array>
			<string>kakao12cbe5606f424138d2aa12ef7361fad5</string>
		</array>
		</dict>
	</array>
	<key>KAKAO_APP_KEY</key>
	<string>12cbe5606f424138d2aa12ef7361fad5</string>
	<!-- <key>KAKAO_APP_SCHEME</key> // 선택 사항 멀티 플랫폼 앱 구현 시에만 추가하면 됩니다
	<string>{카카오 앱 스킴을 적어주세요}</string> // 선택 사항  -->
	<key>LSApplicationQueriesSchemes</key>
	<array>
		<string>kakaokompassauth</string>
		<string>storykompassauth</string>
		<string>kakaolink</string>
	</array>
```

### Swift Bridging Header 설정

xcode에서 file -> new -> file로 들어가서 Swift File을 생성합니다.

블로그 링크 참조

**AppDelegate.m**

```bash
#import "AppDelegate.h"

// kakao login
#import <RNKakaoLogins.h>

#import <React/RCTBundleURLProvider.h>

@implementation AppDelegate

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
  self.moduleName = @"tinqle";
  // You can add your custom initial props in the dictionary below.
  // They will be passed down to the ViewController used by React Native.
  self.initialProps = @{};

  return [super application:application didFinishLaunchingWithOptions:launchOptions];
}

// kakao
- (BOOL)application:(UIApplication *)app
     openURL:(NSURL *)url
     options:(NSDictionary<UIApplicationOpenURLOptionsKey,id> *)options {
 if([RNKakaoLogins isKakaoTalkLoginUrl:url]) {
    return [RNKakaoLogins handleOpenUrl: url];
 }
 return NO;
}
```

![simulator_screenshot_FFF39C1E-63C1-4892-82A2-C377BA3713D3.png](%E1%84%91%E1%85%A2%E1%84%8F%E1%85%B5%E1%84%8C%E1%85%B5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%200f4d9d222b834f8190721ba88ce17a16/simulator_screenshot_FFF39C1E-63C1-4892-82A2-C377BA3713D3.png)

카카오 설정 성공

근데 넘어가질 않는다

login not started [AxiosError: Network Error]

현재 안되는 것으로 확인

## 2. react-native-google-signin/google-signin

빌드랑 상관없는 부분 

but 왜인지 로그인이 안된다. → 

```bash
useEffect(() => {
    console.log('####', Config);
    GoogleSignin.configure({
      webClientId: Config.GOOGLE_CLIENT_ID,
      offlineAccess: true,
    });
  }, []);
```

![스크린샷 2023-12-30 오후 11.37.32.png](%E1%84%91%E1%85%A2%E1%84%8F%E1%85%B5%E1%84%8C%E1%85%B5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%200f4d9d222b834f8190721ba88ce17a16/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-12-30_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_11.37.32.png)

부분에서 config 에 GOOGLE_CLIENT_ID가 없다

.env 파일의 누락이 원인

.env 추가시 구글 로그인은 잘 됨 But axios error 발생

```bash
LOG  error  [AxiosError: Request failed with status code 400]
```

axios.post(`${Config.API_URL}/auth/signup 에서 code가 빠져 있음

```json
{
  "signToken" : String,
	"usePolicy" : true,
	"agePolicy": true,
	"personalPolicy": true,
	"marketPolicy": true,
	"fcmToken": String,
	"code" : String
}
```

임시로 code ‘aaaaaa’값 넣어서 해결

ios 설정에서 firebase가 선행되어야 함을 확인 → auth 인듯

설치 보류

@react-native-firebase/app

@react-native-firebase/auth

@react-native-firebase/messaging

## 3. @react-native-firebase/app

firebase messaging 위해서 app 미리 설치 필요

@react-native-firebase/app 설치 & 설정

참고 링크 : [https://velog.io/@jinsunee/react-native-firebase-설정](https://velog.io/@jinsunee/react-native-firebase-%EC%84%A4%EC%A0%95)

![스크린샷 2024-01-01 오후 1.31.26.png](%E1%84%91%E1%85%A2%E1%84%8F%E1%85%B5%E1%84%8C%E1%85%B5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%200f4d9d222b834f8190721ba88ce17a16/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-01_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_1.31.26.png)

firebase 프로젝트에 ios 추가

![스크린샷 2024-01-01 오후 1.31.09.png](%E1%84%91%E1%85%A2%E1%84%8F%E1%85%B5%E1%84%8C%E1%85%B5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%200f4d9d222b834f8190721ba88ce17a16/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-01_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_1.31.09.png)

![스크린샷 2024-01-01 오후 1.32.02.png](%E1%84%91%E1%85%A2%E1%84%8F%E1%85%B5%E1%84%8C%E1%85%B5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%200f4d9d222b834f8190721ba88ce17a16/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-01_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_1.32.02.png)

ios 프로젝트에 info.plist 추가

[AppDelegate.mm](http://appdelegate.mm/)

```bash
// Firebase 설정 24.01.01
#import <Firebase.h>
//추가된 부분

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{

//추가 된 부분
  if ([FIRApp defaultApp] == nil) {
    [FIRApp configure];
  }
 //추가된 부분

  self.moduleName = @"tinqle";
  // You can add your custom initial props in the dictionary below.
  // They will be passed down to the ViewController used by React Native.
  self.initialProps = @{};

  return [super application:application didFinishLaunchingWithOptions:launchOptions];
}
```

## @react-native-firebase/auth 설치

설치 계속 실패 왜인지 이유 모름

사용하지 않아도 회원가입 됨을 확인 + 한 곳에서만 사용

일단 주석처리 하고 사용하기로 설정