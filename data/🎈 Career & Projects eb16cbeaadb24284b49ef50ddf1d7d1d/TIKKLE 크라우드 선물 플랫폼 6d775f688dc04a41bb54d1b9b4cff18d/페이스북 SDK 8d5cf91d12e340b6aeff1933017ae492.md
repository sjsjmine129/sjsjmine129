# 페이스북 SDK

설치 시 참고 자료

[https://github.com/thebergamo/react-native-fbsdk-next](https://github.com/thebergamo/react-native-fbsdk-next)

[https://surprisecomputer.tistory.com/157](https://surprisecomputer.tistory.com/157)

리액트 네이티브는 sdk가 안깔리기에 react-native-fbsdk-next **모듈을 설치함**

메타 공식문서에서 알려주는 함수는 사용 불가

react-native-fbsdk-next **공식문서가 있지만 어떤 함수가 존재하는지 정리되어 있지는 않음**

페이스북 sdk 초기화

index.js

```jsx
import {Settings} from 'react-native-fbsdk-next';
import {SENTRY_DSN, META_APP_ID} from '@env';

// Setting the facebook app id using setAppID
// Remember to set CFBundleURLSchemes in Info.plist on iOS if needed
Settings.setAppID(META_APP_ID); //앱 아이디 지정
Settings.initializeSDK();   // 초기화
Settings.setAdvertiserTrackingEnabled(true);   //ios 광고 추적 활성화

```

초기화만 하면 기본 페이스북 이벤트 들은 찍힘

[자동으로 찍히는 이벤트]

**앱 활성화, 앱설치 등**

기본적으로 앱내부에서 뭔가 인터랙션이 있는 것들은 찍히지 않음

 ex) 앱 등록, 장바구니, 구매 …   → 우리가 직접 이벤트 호출 해야함

맞춤 이벤트 : 내가 자율적으로 이름과 값을 입력해서 로깅하는 것 → 위 이벤트를 많이 일어나게 하도록 광고 게재가능 

```jsx

import {AppEventsLogger} from 'react-native-fbsdk-next';

AppEventsLogger.logEvent('test_ios', {    //이벤트의 이름
            param1: 'value12',            //이벤트에 저장할 값들
            param2: 'value22',
            // ... other parameters
          }); 
```

표준 이벤트

[https://developers.facebook.com/docs/marketing-api/app-event-api/](https://developers.facebook.com/docs/marketing-api/app-event-api/)

위 링크에 “**표준 이벤트 이름” 표에 있는 표준이벤트를 로깅 하려면 2가지 방법이 존재**

1. 'react-native-fbsdk-next'의 자체 맞춤 함수를 사용

[https://www.npmjs.com/package/react-native-fbsdk-next](https://www.npmjs.com/package/react-native-fbsdk-next)

아래의 예시처럼 표준 이벤트에  맞는 함수를 제공하는 경우 → 위 링크 공식 문서의 형태를 따르면 된다

단, 모든 표준함수에 대한 함수가 존재하지 않음 + 어떤게 있는지 표시 되어있지 않음 (자료 없음)

```jsx
import {AppEventsLogger} from 'react-native-fbsdk-next';

AppEventsLogger.logPurchase(15, "USD", { param: "value" });
```

1. logEvent 를 사용해서 표준이벤트를 직접 로깅
    
    AppEventsLogger.logEvent( **Event Name** , **_valueToSum** , **Event Parameters**);
    
    의 형태로 직접 표준이벤트를 로깅 
    
    [https://developers.facebook.com/docs/marketing-api/app-event-api/](https://developers.facebook.com/docs/marketing-api/app-event-api/)
    
    위 링크의 표준이벤트 이름 표에서  **Event Name** , **_valueToSum** , **Event Parameters 참고해 함수를 사용하면 표준이벤트를 직접 로깅할 수 있다.**
    

ex) 1

```jsx
import {AppEventsLogger} from 'react-native-fbsdk-next';

const params = {
            fb_content_type: 'contentType', //링크에 표에서 값 참조해서 사용
            fb_content_id: 'contentId',
            fb_currency: 'USD',
          };
AppEventsLogger.logEvent('fb_mobile_add_to_cart', totalPrice, params);
													
```

ex) 2

```jsx
import {AppEventsLogger} from 'react-native-fbsdk-next';

const params = {
            fb_registration_method: 'TEST_and',
          };
          AppEventsLogger.logEvent(
            'fb_mobile_complete_registration',
            1,
            params,
          );
```

## 이벤트 테스트 (실시간 확인)

firebase 처럼 페이스북도 로깅이 되는데 약 1시간~30분이 걸린다. 즉 firebase의 디버그 모드 처럼 실시간으로 로깅을 확인하는 이벤트 테스트가 존재 

[https://www.facebook.com/events_manager2/list/app/1661497471012290/test_events?global_scope_id=100008506980236&act=1349558869245736](https://www.facebook.com/events_manager2/list/app/1661497471012290/test_events?global_scope_id=100008506980236&act=1349558869245736)

위 링크는 이벤트 테스트를 할 수 있는 메타의 콘솔

![스크린샷 2023-12-21 오전 11.25.22.png](%E1%84%91%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%87%E1%85%AE%E1%86%A8%20SDK%208d5cf91d12e340b6aeff1933017ae492/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-12-21_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%258C%25E1%2585%25A5%25E1%2586%25AB_11.25.22.png)

등록된 기기가 켜졌을 때 자동으로 실시간 활동을 캐치 한다.

문제는 기기를 등록하는 방식이 따로 지정되어 있지 않다는 점.

firebase가 여러 기기를 동시에 로깅하는 것과 다르게 메타는 1기기만 로깅을 하는 것 같은데

이 1대의 기기를 지정, 지정해제하는 방법이 없음 (내가 못찾는 것일 수도)

아무 설정도 하지 않았지만 현재 내(엄승주)의 계정에는 내 갤럭시 기기가 자동으로 등록되어 앱이 켜질 때마다 이벤트 테스트에 바로 로깅이 된다.

설정 문제인지 기기가 1개를 넘길 수 없는 것인지 모름

일단 테스트도 되고, 아이폰도 시간이 지나면 로깅이 되는 것을 확인해서 잘 로깅이 되는 것은 확인

 

요약

현재 : 엄승주 계정에는 엄승주의 갤럭시 폰만 이벤트 테스트에 로깅이됨

예상 : 1. 메타는 계정당 1대의 기기만 로깅이 됨 ⇒ 문제: 이 1 대의 기기를 설정 하는 방법을 못찾음

         2. 설정 오류 ⇒ 1시간 후 실제 데이터가 로깅이 되는 것을보니 오류는 아닌듯

로깅 시의 모습

![스크린샷 2023-12-21 오후 12.31.17.png](%E1%84%91%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%87%E1%85%AE%E1%86%A8%20SDK%208d5cf91d12e340b6aeff1933017ae492/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-12-21_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_12.31.17.png)

PS (테스트로 썼던 코드)

[페이스북 로그인 버튼]

```jsx
import {LoginButton, AccessToken} from 'react-native-fbsdk-next';

return(
<View>
        <LoginButton
          onLoginFinished={(error, result) => {
            if (error) {
              console.log('login has error: ' + result.error);
            } else if (result.isCancelled) {
              console.log('login is cancelled.');
            } else {
              AccessToken.getCurrentAccessToken().then(data => {
                console.log(data.accessToken.toString());
              });
            }
          }}
          onLogoutFinished={() => console.log('logout.')}
        />
      </View>
);
```